[gd_scene load_steps=17 format=3 uid="uid://dkrek85drmrcm"]

[ext_resource type="Script" uid="uid://cpoq0jx7ynmx4" path="res://scripts/beat_manager.gd" id="1_ig7tw"]
[ext_resource type="Script" path="res://scripts/game_manager.gd" id="1_ycdy4"]
[ext_resource type="Script" uid="uid://cvwfp2oi3vfgt" path="res://scripts/tower_commands.gd" id="2_0xm2m"]
[ext_resource type="Script" uid="uid://cu33sk4vrqmwd" path="res://scripts/camera_system.gd" id="2_4c57u"]
[ext_resource type="PackedScene" uid="uid://ekvd4x362un0" path="res://models/kenney_castle-kit/Models/GLB format/siege-tower.glb" id="3_h2yge"]
[ext_resource type="PackedScene" uid="uid://b1y3alau8s1yk" path="res://scenes/enemy.tscn" id="4_lquwl"]
[ext_resource type="Script" uid="uid://bstrnm41l537j" path="res://scripts/turret_placing_system.gd" id="5_w48qg"]
[ext_resource type="PackedScene" uid="uid://cmtc0ktsl0hol" path="res://scenario.tscn" id="6_7mycd"]
[ext_resource type="Material" uid="uid://d62s83ljgkdn" path="res://materials/ghost_placing_mat.tres" id="6_vivmo"]
[ext_resource type="PackedScene" uid="uid://bj00uy7063ljh" path="res://scenes/turret_ballista.tscn" id="7_272bh"]
[ext_resource type="Script" uid="uid://b3yluy74ogwjc" path="res://scripts/projectiles_manager.gd" id="7_kek77"]
[ext_resource type="PackedScene" uid="uid://sucn46hw8pud" path="res://scenes/projectil.tscn" id="8_4c57u"]
[ext_resource type="PackedScene" uid="uid://dj00r0ko3oygm" path="res://scenes/projectil_magic.tscn" id="9_efxa6"]
[ext_resource type="PackedScene" uid="uid://gvld7w0mgelx" path="res://ui/HUD.tscn" id="10_efxa6"]
[ext_resource type="Script" path="res://scripts/wave_manager.gd" id="12_dg77c"]

[sub_resource type="Environment" id="Environment_dg77c"]
ssr_enabled = true
ssil_radius = 5.8
sdfgi_use_occlusion = true
sdfgi_read_sky_light = false
glow_enabled = true
glow_bloom = 1.0
glow_blend_mode = 4
volumetric_fog_density = 0.07
volumetric_fog_albedo = Color(0, 0.419608, 0.207843, 1)
volumetric_fog_emission_energy = 2.0
adjustment_enabled = true
adjustment_brightness = 1.42
adjustment_contrast = 1.04
adjustment_saturation = 1.07

[node name="Main" type="Node3D"]

[node name="GameManager" type="Node" parent="." node_paths=PackedStringArray("waypoints_container")]
script = ExtResource("1_ycdy4")
waypoints_container = NodePath("../WaypointsContainer")

[node name="WaypointsContainer" type="Node3D" parent="."]
unique_name_in_owner = true
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.781081, 0)

[node name="CSGSphere3D" type="CSGSphere3D" parent="WaypointsContainer"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -3.45763, 0, -0.942249)
radius = 0.2

[node name="CSGSphere3D2" type="CSGSphere3D" parent="WaypointsContainer"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -1.79287, 0, -0.942249)
radius = 0.2

[node name="CSGSphere3D3" type="CSGSphere3D" parent="WaypointsContainer"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.2892, 0, -0.942249)
radius = 0.2

[node name="CSGSphere3D4" type="CSGSphere3D" parent="WaypointsContainer"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 1.58129, 0, -0.802787)
radius = 0.2

[node name="CSGSphere3D7" type="CSGSphere3D" parent="WaypointsContainer"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 1.58129, 0, 2.4706)
radius = 0.2

[node name="BeatManager" type="Node" parent="."]
script = ExtResource("1_ig7tw")
metadata/_custom_type_script = "uid://cpoq0jx7ynmx4"

[node name="ProjectilesManager" type="Node" parent="."]
script = ExtResource("7_kek77")
projectile_scenes = Dictionary[int, PackedScene]({
0: ExtResource("8_4c57u"),
1: ExtResource("9_efxa6"),
2: ExtResource("8_4c57u")
})
metadata/_custom_type_script = "uid://b3yluy74ogwjc"

[node name="TurretPlacingSystem" type="Node3D" parent="." node_paths=PackedStringArray("allowed_locations_parent")]
script = ExtResource("5_w48qg")
_available_turrets_by_name = Dictionary[int, PackedScene]({
0: ExtResource("7_272bh")
})
ghost_material = ExtResource("6_vivmo")
allowed_locations_parent = NodePath(".")

[node name="PlaceSlot" type="CSGBox3D" parent="TurretPlacingSystem"]
transform = Transform3D(1, 0, 0, 0, 1.01473, 0, 0, 0, 1, -1.47342, 0.246497, 4.4398)
material_override = ExtResource("6_vivmo")
size = Vector3(1, 0.0776367, 1)

[node name="PlaceSlot2" type="CSGBox3D" parent="TurretPlacingSystem"]
transform = Transform3D(1, 0, 0, 0, 1.01473, 0, 0, 0, 1, 1.8732, 0.246497, 4.05897)
material_override = ExtResource("6_vivmo")
size = Vector3(1, 0.0776367, 1)

[node name="CSGBox3D" type="CSGBox3D" parent="."]
transform = Transform3D(13.7756, 0, 0, 0, 0.253638, 0, 0, 0, 9.71064, 0, 0, 0)
use_collision = true

[node name="Camera3D" type="Camera3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 0.258819, 0.965926, 0, -0.965926, 0.258819, 0.862187, 4.71731, 3.35591)
fov = 60.0
script = ExtResource("2_4c57u")
speed = 3.0

[node name="DirectionalLight3D" type="DirectionalLight3D" parent="."]
transform = Transform3D(0.970197, 0.241975, -0.0128731, -0.154515, 0.658702, 0.736367, 0.186662, -0.712432, 0.67646, 1.44224, 0.776473, 0.413263)
light_energy = 0.0

[node name="siege-tower2" parent="." instance=ExtResource("3_h2yge")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -3.45763, 0, -0.942249)

[node name="Enemy" parent="." instance=ExtResource("4_lquwl")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 4.42524, 0.786312, 4.26443)

[node name="TurretBallista2" parent="." instance=ExtResource("7_272bh")]
transform = Transform3D(1, 0, -7.45058e-09, 0, 1, 0, 7.45058e-09, 0, 1, -4.76837e-07, 0, 0)

[node name="TowerCommands" type="Node" parent="TurretBallista2" node_paths=PackedStringArray("shooter")]
script = ExtResource("2_0xm2m")
shooter = NodePath("..")
metadata/_custom_type_script = "uid://cvwfp2oi3vfgt"

[node name="TurretBallista" parent="." instance=ExtResource("7_272bh")]
transform = Transform3D(-0.997168, 0, 0.075205, 0, 1, 0, -0.075205, 0, -0.997168, 2.74, 0, -1.244)

[node name="TowerCommands" type="Node" parent="TurretBallista" node_paths=PackedStringArray("shooter")]
script = ExtResource("2_0xm2m")
shooter = NodePath("..")
metadata/_custom_type_script = "uid://cvwfp2oi3vfgt"

[node name="CanvasLayer" type="CanvasLayer" parent="."]

[node name="Hud" parent="CanvasLayer" instance=ExtResource("10_efxa6")]

[node name="Scenario" parent="." instance=ExtResource("6_7mycd")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -1.16527, 0.0718123, 4.6856)

[node name="LightPoint" type="CSGSphere3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 5.52405, 0.809705, 0.355299)
radius = 0.1

[node name="OmniLight3D" type="OmniLight3D" parent="LightPoint"]
light_color = Color(0.911754, 0.50887, 5.77569e-07, 1)
light_energy = 1.741
light_indirect_energy = 2.0

[node name="LightPoint2" type="CSGSphere3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -2.08312, 0.8123, -0.573885)
radius = 0.1

[node name="OmniLight3D" type="OmniLight3D" parent="LightPoint2"]
light_color = Color(0.911754, 0.50887, 5.77569e-07, 1)
light_energy = 1.741
light_indirect_energy = 2.0

[node name="LightPoint3" type="CSGSphere3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -2.08312, 1.62249, -0.860845)
radius = 0.1

[node name="OmniLight3D" type="OmniLight3D" parent="LightPoint3"]
light_color = Color(0.911754, 0.50887, 5.77569e-07, 1)
light_energy = 1.741
light_indirect_energy = 2.0

[node name="WorldEnvironment" type="WorldEnvironment" parent="."]
environment = SubResource("Environment_dg77c")

[node name="WaveManager" type="Node" parent="." node_paths=PackedStringArray("spawn_position")]
script = ExtResource("12_dg77c")
enemy_scene = ExtResource("4_lquwl")
spawn_position = NodePath("../EnemySpawnSpot")

[node name="SpawnTimer" type="Timer" parent="WaveManager"]

[node name="WaveTimer" type="Timer" parent="WaveManager"]

[node name="EnemySpawnSpot" type="Node3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 4.42524, 0.786312, 4.26443)
